{
  "migrationFile": {
    "version": "1.0.0",
    "description": "LearnerAI microservice - AI-powered personalized learning path generation, skills gap analysis, and course recommendations",
    "database": {
      "tables": [
        {
          "name": "companies",
          "schema": {
            "company_id": "UUID PRIMARY KEY",
            "company_name": "TEXT NOT NULL",
            "decision_maker_policy": "TEXT NOT NULL CHECK (decision_maker_policy IN ('auto', 'manual'))",
            "decision_maker": "JSONB",
            "created_at": "TIMESTAMP WITH TIME ZONE",
            "last_modified_at": "TIMESTAMP WITH TIME ZONE"
          }
        },
        {
          "name": "learners",
          "schema": {
            "user_id": "UUID PRIMARY KEY",
            "company_id": "UUID NOT NULL",
            "company_name": "TEXT NOT NULL",
            "user_name": "TEXT NOT NULL",
            "created_at": "TIMESTAMP WITH TIME ZONE",
            "last_modified_at": "TIMESTAMP WITH TIME ZONE"
          }
        },
        {
          "name": "skills_gap",
          "schema": {
            "gap_id": "UUID PRIMARY KEY",
            "user_id": "UUID NOT NULL",
            "company_id": "UUID NOT NULL",
            "company_name": "TEXT NOT NULL",
            "user_name": "TEXT NOT NULL",
            "skills_raw_data": "JSONB NOT NULL",
            "exam_status": "TEXT CHECK (exam_status IN ('pass', 'fail'))",
            "competency_target_name": "TEXT NOT NULL",
            "created_at": "TIMESTAMP WITH TIME ZONE",
            "last_modified_at": "TIMESTAMP WITH TIME ZONE"
          }
        },
        {
          "name": "skills_expansions",
          "schema": {
            "expansion_id": "UUID PRIMARY KEY",
            "gap_id": "UUID",
            "user_id": "UUID NOT NULL",
            "prompt_1_output": "JSONB",
            "prompt_2_output": "JSONB",
            "created_at": "TIMESTAMP WITH TIME ZONE",
            "last_modified_at": "TIMESTAMP WITH TIME ZONE"
          }
        },
        {
          "name": "courses",
          "schema": {
            "competency_target_name": "TEXT PRIMARY KEY",
            "user_id": "UUID NOT NULL",
            "gap_id": "UUID",
            "learning_path": "JSONB NOT NULL",
            "approved": "BOOLEAN DEFAULT FALSE",
            "created_at": "TIMESTAMP WITH TIME ZONE",
            "last_modified_at": "TIMESTAMP WITH TIME ZONE"
          }
        },
        {
          "name": "recommendations",
          "schema": {
            "recommendation_id": "UUID PRIMARY KEY",
            "user_id": "UUID NOT NULL",
            "base_course_name": "TEXT NOT NULL",
            "suggested_courses": "JSONB NOT NULL",
            "sent_to_rag": "BOOLEAN DEFAULT FALSE",
            "created_at": "TIMESTAMP WITH TIME ZONE",
            "last_modified_at": "TIMESTAMP WITH TIME ZONE"
          }
        },
        {
          "name": "jobs",
          "schema": {
            "id": "UUID PRIMARY KEY",
            "user_id": "UUID NOT NULL",
            "company_id": "UUID",
            "competency_target_name": "TEXT",
            "type": "VARCHAR(100) CHECK (type IN ('path-generation', 'course-suggestion', 'path-distribution'))",
            "status": "VARCHAR(50) CHECK (status IN ('pending', 'processing', 'completed', 'failed'))",
            "progress": "INTEGER DEFAULT 0",
            "current_stage": "VARCHAR(100)",
            "result": "JSONB",
            "error": "TEXT",
            "created_at": "TIMESTAMP WITH TIME ZONE",
            "updated_at": "TIMESTAMP WITH TIME ZONE"
          }
        },
        {
          "name": "path_approvals",
          "schema": {
            "id": "UUID PRIMARY KEY",
            "learning_path_id": "TEXT NOT NULL",
            "company_id": "UUID NOT NULL",
            "decision_maker_id": "UUID NOT NULL",
            "status": "TEXT CHECK (status IN ('pending', 'approved', 'rejected', 'changes_requested'))",
            "feedback": "TEXT",
            "approved_at": "TIMESTAMP WITH TIME ZONE",
            "rejected_at": "TIMESTAMP WITH TIME ZONE",
            "changes_requested_at": "TIMESTAMP WITH TIME ZONE",
            "created_at": "TIMESTAMP WITH TIME ZONE",
            "updated_at": "TIMESTAMP WITH TIME ZONE"
          }
        }
      ],
      "migrations": [
        {
          "version": "1.0.0",
          "name": "learner_ai_migration",
          "file": "database/migrations/learner_ai_migration.sql",
          "description": "Initial database schema migration for LearnerAI platform",
          "appliedAt": null,
          "tables": [
            "companies",
            "learners",
            "skills_gap",
            "skills_expansions",
            "courses",
            "recommendations",
            "jobs",
            "path_approvals"
          ]
        }
      ]
    },
    "api": {
      "endpoints": [
        {
          "path": "/api/fill-content-metrics",
          "method": "POST",
          "description": "Unified endpoint for inter-service communication via Coordinator",
          "requestSchema": {
            "type": "object",
            "properties": {
              "requester_service": { 
                "type": "string", 
                "required": true,
                "description": "Name of the service making the request (e.g., 'course-builder', 'analytics', 'skills-engine', 'ai')"
              },
              "payload": {
                "type": "object",
                "required": true,
                "description": "Service-specific data based on the action",
                "properties": {
                  "action": { 
                    "type": "string", 
                    "required": true,
                    "description": "Action to perform (e.g., 'request_learning_path', 'query', 'chat', 'update_skills_gap')"
                  }
                }
              },
              "response": {
                "type": "object",
                "required": true,
                "description": "Template defining expected response structure"
              }
            },
            "required": ["requester_service", "payload", "response"]
          },
          "responseSchema": {
            "type": "object",
            "properties": {
              "success": { "type": "boolean" },
              "data": { "type": "object" },
              "error": { "type": "string" },
              "message": { "type": "string" }
            }
          }
        }
      ]
    },
    "dependencies": [
      "skills-engine-service",
      "course-builder-service",
      "learning-analytics-service",
      "management-reports-service",
      "rag-microservice",
      "directory-service"
    ],
    "capabilities": [
      "learning path generation",
      "personalized learning paths",
      "skills gap analysis",
      "skills gap detection",
      "course recommendations",
      "course suggestions",
      "path approvals",
      "approval workflow",
      "AI queries",
      "AI chat",
      "Gemini AI integration",
      "inter-service communication",
      "learner management",
      "company management",
      "competency tracking",
      "exam status tracking",
      "async job processing",
      "learning path distribution"
    ],
    "events": {
      "publishes": [
        "learning-path.generated",
        "learning-path.approved",
        "learning-path.rejected",
        "learning-path.changes-requested",
        "course.completed",
        "course-suggestions.generated"
      ],
      "subscribes": [
        "skills-gap.detected",
        "company.registered",
        "company.updated",
        "exam.completed"
      ]
    }
  }
}

