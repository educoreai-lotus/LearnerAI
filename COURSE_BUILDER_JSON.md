# Course Builder JSON Payload

This document describes the exact JSON structure sent to the Course Builder microservice when a learning path is ready.

---

## üì§ Endpoint

**POST** `{COURSE_BUILDER_URL}/api/v1/learning-paths`

**Headers:**
```
Content-Type: application/json
Authorization: Bearer {COURSE_BUILDER_TOKEN}
X-Service-Token: {COURSE_BUILDER_TOKEN}
```

---

## üìã JSON Body Structure (General Specification)

```json
{
  "user_id": "string (UUID)",
  "user_name": "string",
  "company_id": "string (UUID)",
  "company_name": "string",
  "competency_target_name": "string",
  "learning_path": {
    "steps": [
      {
        "step": "number",
        "title": "string",
        "duration": "string",
        "resources": ["string"],
        "objectives": ["string"],
        "estimatedTime": "string"
      }
    ],
    "estimatedCompletion": "string",
    "totalSteps": "number",
    "createdAt": "string (ISO DateTime)",
    "updatedAt": "string (ISO DateTime)"
  }
}
```

**Note:** The `learning_path` field contains the complete learning path structure (JSONB from courses table). The structure may vary based on how the learning path was generated by Gemini AI.

---

## üîë Field Descriptions

### Root Level Fields

| Field | Type | Required | Description |
|-------|------|---------|-------------|
| `user_id` | String (UUID) | ‚úÖ Yes | Unique identifier for the learner |
| `user_name` | String | ‚úÖ Yes | Full name of the learner |
| `company_id` | String (UUID) | ‚úÖ Yes | Unique identifier for the company |
| `company_name` | String | ‚úÖ Yes | Name of the company |
| `competency_target_name` | String | ‚úÖ Yes | The competency/course name |
| `learning_path` | Object (JSONB) | ‚úÖ Yes | Complete learning path structure (JSONB from courses table) |

### Learning Path Object (`learning_path`)

**Note:** The `learning_path` field contains the complete learning path structure as stored in the database (JSONB from courses table). This is the primary source of truth for Course Builder.

| Field | Type | Required | Description |
|-------|------|---------|-------------|
| `steps` | Array | ‚úÖ Yes | Array of learning path step objects |
| `estimatedCompletion` | String | ‚ö†Ô∏è Optional | Estimated time to complete the entire path |
| `totalSteps` | Number | ‚ö†Ô∏è Optional | Total number of steps in the path |
| `createdAt` | String (ISO DateTime) | ‚ö†Ô∏è Optional | When the path was created |
| `updatedAt` | String (ISO DateTime) | ‚ö†Ô∏è Optional | When the path was last updated |

### Step Object (within `steps` array)

| Field | Type | Required | Description |
|-------|------|---------|-------------|
| `step` | Number | ‚ö†Ô∏è Optional | Step number (1, 2, 3, ...) |
| `title` | String | ‚ö†Ô∏è Optional | Step title/name |
| `duration` | String | ‚ö†Ô∏è Optional | Estimated duration for this step |
| `resources` | Array of Strings | ‚ö†Ô∏è Optional | Learning resources for this step |
| `objectives` | Array of Strings | ‚ö†Ô∏è Optional | Learning objectives for this step |
| `estimatedTime` | String | ‚ö†Ô∏è Optional | Estimated time to complete this step |

**Note:** Step object fields are flexible and depend on what Gemini AI generates in the learning path.

---

## üìù Example Implementation

```javascript
// In DistributePathUseCase.js
// Fetch learning path and skills gap data
const learningPath = await repository.getLearningPathById(competencyTargetName);
const skillsGap = await skillsGapRepository.getSkillsGapByUserAndCompetency(
  learningPath.userId,
  competencyTargetName
);

// Build Course Builder payload with required fields
const courseBuilderPayload = {
  user_id: learningPath.userId,
  user_name: skillsGap.user_name, // From skills_gap table
  company_id: skillsGap.company_id, // From skills_gap table
  company_name: skillsGap.company_name, // From skills_gap table
  competency_target_name: competencyTargetName,
  learning_path: learningPath.pathMetadata || learningPath.learning_path || learningPath.toJSON()
};

// Send to Course Builder
await courseBuilderClient.sendLearningPath(courseBuilderPayload);
```

---

## üìÑ Example JSON Payload

Here's a concrete example with sample data:

```json
{
  "user_id": "660e8400-e29b-41d4-a716-446655440001",
  "user_name": "Alice Johnson",
  "company_id": "550e8400-e29b-41d4-a716-446655440001",
  "company_name": "TechCorp Solutions",
  "competency_target_name": "JavaScript Basics",
  "learning_path": {
    "steps": [
      {
        "step": 1,
        "title": "Introduction to ES6",
        "duration": "2 weeks",
        "resources": ["ES6 Guide", "Practice Exercises"],
        "objectives": ["Understand ES6 syntax", "Learn arrow functions"],
        "estimatedTime": "10 hours"
      },
      {
        "step": 2,
        "title": "Arrow Functions",
        "duration": "1 week",
        "resources": ["Arrow Functions Tutorial"],
        "objectives": ["Master arrow function syntax"],
        "estimatedTime": "5 hours"
      }
    ],
    "estimatedCompletion": "4 weeks",
    "totalSteps": 2,
    "createdAt": "2025-11-12T10:30:00Z",
    "updatedAt": "2025-11-12T10:35:00Z"
  }
}
```

---

## üîÑ Difference from Learning Analytics Payload

**Course Builder** receives:
- ‚úÖ `user_id`, `user_name`, `company_id`, `company_name`
- ‚úÖ `competency_target_name`
- ‚úÖ `learning_path` (JSONB structure)
- ‚ùå Does NOT receive: `gap_id`, `skills_raw_data`, `exam_status`

**Learning Analytics** receives:
- ‚úÖ `user_id`, `user_name`, `company_id`, `company_name`
- ‚úÖ `competency_target_name`
- ‚úÖ `learning_path` (JSONB structure)
- ‚úÖ **Plus**: `gap_id`, `skills_raw_data`, `exam_status` (for analytics)

---

## ‚úÖ Validation Rules

### Required Fields (Must be present):
- ‚úÖ `user_id` - Must be valid UUID format
- ‚úÖ `user_name` - Must be non-empty string
- ‚úÖ `company_id` - Must be valid UUID format
- ‚úÖ `company_name` - Must be non-empty string
- ‚úÖ `competency_target_name` - Must be non-empty string
- ‚úÖ `learning_path` - Must be valid JSON object (JSONB from courses table)
- ‚úÖ `learning_path.steps` - Must be an array (can be empty)

### Optional Fields:
- ‚ö†Ô∏è `learning_path.estimatedCompletion` - Optional string
- ‚ö†Ô∏è `learning_path.totalSteps` - Optional number
- ‚ö†Ô∏è `learning_path.createdAt` - Optional ISO DateTime string
- ‚ö†Ô∏è `learning_path.updatedAt` - Optional ISO DateTime string
- ‚ö†Ô∏è Step object fields - All optional, structure depends on AI generation

---

**This JSON structure provides Course Builder with all the information needed to build the course content!** ‚úÖ

