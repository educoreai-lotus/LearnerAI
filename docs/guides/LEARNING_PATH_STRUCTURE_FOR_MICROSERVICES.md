# Learning Path Structure for Course Builder & Content Studio

This document defines the **exact JSON structure** that Course Builder and Content Studio should expect when receiving learning paths from LearnerAI.

---

## ðŸ“‹ Overview

LearnerAI generates learning paths using a **module-based structure** (from Prompt 3). The structure is stored in the `courses.learning_path` JSONB column and sent directly to Course Builder and Content Studio.

**Important:** The structure may contain **both formats** for backward compatibility:
1. **Primary Format:** `learning_modules` (module-based, from Prompt 3)
2. **Legacy Format:** `steps` (step-based, for backward compatibility)

---

## ðŸŽ¯ Complete Payload Structure

### Root Level (What Course Builder/Content Studio Receives)

```json
{
  "user_id": "string (UUID)",
  "user_name": "string",
  "company_id": "string (UUID)",
  "company_name": "string",
  "competency_target_name": "string",
  "learning_path": {
    // See learning_path structure below
  }
}
```

---

## ðŸ“¦ Learning Path Structure (`learning_path` field)

The `learning_path` object contains the complete learning path structure. It may have **one or both** of these formats:

### Format 1: Module-Based (Primary - Generated by Prompt 3)

```json
{
  "pathTitle": "Personalized Mastery Path for [Learner Role] to [Target Goal]",
  "totalDurationHours": 82,
  "learning_modules": [
    {
      "module_order": 1,
      "module_title": "Module 1: C++ Foundational Syntax and Control Flow",
      "estimated_duration_hours": 4,
      "focus_micro_skills": [
        "Variables and Data Types",
        "Input and Output (cin, cout)",
        "Control Flow (if, switch, loops)"
      ],
      "learning_goals": [
        "Master basic C++ syntax, data types, console I/O, and fundamental control structures.",
        "Understand foundational C++ programming concepts."
      ],
      "suggested_content_sequence": [
        "Lesson: Variables and Data Types (Nano: Variables and Data Types)",
        "Lesson: Input and Output (cin, cout) (Nano: Console I/O)",
        "Practice Lab: Implementing Foundational C++ Programs",
        "Assessment: Module 1 Proficiency Quiz"
      ]
    },
    {
      "module_order": 2,
      "module_title": "Module 2: Functions, Modularity, and Scope Management",
      "estimated_duration_hours": 5,
      "focus_micro_skills": [
        "Functions and Parameters",
        "Scope and Lifetime of Variables",
        "Function Overloading"
      ],
      "learning_goals": [
        "Understand how to structure code with functions, manage variable scope, and overload functions for flexibility."
      ],
      "suggested_content_sequence": [
        "Lesson: Functions and Parameters (Nano: Defining and Calling Functions)",
        "Practice Lab: Designing Modular C++ Functions",
        "Assessment: Module 2 Application Project"
      ]
    }
    // ... more modules
  ],
  "status": "approved",
  "metadata": {},
  "companyId": "uuid",
  "competencyTargetName": "string"
}
```

### Format 2: Steps-Based (Legacy - May be present for backward compatibility)

```json
{
  "pathTitle": "Personalized Mastery Path for [Learner Role] to [Target Goal]",
  "totalDurationHours": 82,
  "steps": [
    {
      "step": 0,
      "title": "Lesson Title",
      "duration": "15 minutes",
      "resources": [],
      "objectives": ["Objective 1", "Objective 2"],
      "estimatedTime": "15 minutes"
    }
    // ... more steps
  ],
  "estimatedCompletion": "82 hours",
  "totalSteps": 14,
  "createdAt": "2025-12-11T07:34:24.335Z",
  "updatedAt": "2025-12-11T07:34:24.335Z"
}
```

---

## ðŸ”‘ Field Definitions

### Root Level Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `user_id` | String (UUID) | âœ… Yes | Unique identifier for the learner |
| `user_name` | String | âœ… Yes | Full name of the learner |
| `company_id` | String (UUID) | âœ… Yes | Unique identifier for the company |
| `company_name` | String | âœ… Yes | Name of the company |
| `competency_target_name` | String | âœ… Yes | The competency/course name (e.g., "C++ basics Noam") |
| `learning_path` | Object (JSONB) | âœ… Yes | Complete learning path structure |

---

### Learning Path Object (`learning_path`)

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `pathTitle` | String | âš ï¸ Optional | Title of the learning path |
| `totalDurationHours` | Number | âš ï¸ Optional | Total estimated duration in hours |
| `learning_modules` | Array | âš ï¸ Conditional | **Primary format** - Array of module objects (if module-based) |
| `steps` | Array | âš ï¸ Conditional | **Legacy format** - Array of step objects (if step-based) |
| `estimatedCompletion` | String | âš ï¸ Optional | Estimated completion time (for steps format) |
| `totalSteps` | Number | âš ï¸ Optional | Total number of steps (for steps format) |
| `createdAt` | String (ISO DateTime) | âš ï¸ Optional | When the path was created |
| `updatedAt` | String (ISO DateTime) | âš ï¸ Optional | When the path was last updated |
| `status` | String | âš ï¸ Optional | Approval status: "approved", "pending", "rejected" |
| `metadata` | Object | âš ï¸ Optional | Additional metadata (usually empty object `{}`) |
| `companyId` | String (UUID) | âš ï¸ Optional | Company ID (duplicate of root level) |
| `competencyTargetName` | String | âš ï¸ Optional | Competency name (duplicate of root level) |

---

### Module Object (within `learning_modules` array)

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `module_order` | Number | âœ… Yes | Module sequence number (1, 2, 3...) |
| `module_title` | String | âœ… Yes | Title of the module |
| `estimated_duration_hours` | Number | âœ… Yes | Estimated duration for this module in hours |
| `skills_in_module` | Array of Strings | âœ… Yes | **New format** - List of lowest-level skills included in this module |
| `focus_micro_skills` | Array of Strings | âš ï¸ Legacy | **Legacy format** - Alias for `skills_in_module` (for backward compatibility) |
| `learning_goals` | Array of Strings | âœ… Yes | Learning objectives/goals for this module |
| `steps` | Array of Step Objects | âœ… Conditional | **New format** - Array of structured step objects (if using new format) |
| `suggested_content_sequence` | Array of Strings | âš ï¸ Legacy | **Legacy format** - Ordered list of content items as strings (for backward compatibility) |

**Example Module (New Format with Steps):**
```json
{
  "module_order": 1,
  "module_title": "Module 1: C++ Foundational Syntax and Control Flow",
  "estimated_duration_hours": 4,
  "skills_in_module": [
    "Variables and Data Types",
    "Input and Output (cin, cout)",
    "Control Flow (if, switch, loops)"
  ],
  "learning_goals": [
    "Master basic C++ syntax, data types, console I/O, and fundamental control structures.",
    "Understand foundational C++ programming concepts."
  ],
  "steps": [
    {
      "step": 1,
      "title": "Variables and Data Types",
      "step_type": "lesson",
      "content_type": "text",
      "description": "Learn about C++ variable declarations and data types",
      "estimatedTime": 60,
      "resources": ["C++ Variables Guide", "Data Types Reference"],
      "objectives": ["Understand variable declarations", "Learn about data types"],
      "skills_covered": ["Variables and Data Types"]
    },
    {
      "step": 2,
      "title": "Input and Output (cin, cout)",
      "step_type": "lesson",
      "content_type": "interactive",
      "description": "Master console I/O operations",
      "estimatedTime": 45,
      "resources": ["I/O Tutorial"],
      "objectives": ["Use cin for input", "Use cout for output"],
      "skills_covered": ["Input and Output (cin, cout)"]
    },
    {
      "step": 3,
      "title": "Implementing Foundational C++ Programs",
      "step_type": "lab",
      "content_type": "code",
      "description": "Practice lab for foundational concepts",
      "estimatedTime": 90,
      "resources": ["Lab Instructions"],
      "objectives": ["Apply variables and I/O", "Write basic C++ programs"],
      "skills_covered": ["Variables and Data Types", "Input and Output (cin, cout)"]
    },
    {
      "step": 4,
      "title": "Module 1 Proficiency Quiz",
      "step_type": "quiz",
      "content_type": "interactive",
      "description": "Assessment for Module 1",
      "estimatedTime": 30,
      "resources": [],
      "objectives": ["Test understanding of foundational concepts"],
      "skills_covered": ["Variables and Data Types", "Input and Output (cin, cout)", "Control Flow (if, switch, loops)"]
    }
  ]
}
```

**Example Module (Legacy Format with suggested_content_sequence):**
```json
{
  "module_order": 1,
  "module_title": "Module 1: C++ Foundational Syntax and Control Flow",
  "estimated_duration_hours": 4,
  "focus_micro_skills": [
    "Variables and Data Types",
    "Input and Output (cin, cout)",
    "Control Flow (if, switch, loops)"
  ],
  "learning_goals": [
    "Master basic C++ syntax, data types, console I/O, and fundamental control structures.",
    "Understand foundational C++ programming concepts."
  ],
  "suggested_content_sequence": [
    "Lesson: Variables and Data Types (Nano: Variables and Data Types)",
    "Lesson: Input and Output (cin, cout) (Nano: Console I/O)",
    "Practice Lab: Implementing Foundational C++ Programs",
    "Assessment: Module 1 Proficiency Quiz"
  ]
}
```

---

### Step Object (within `steps` array - New Format)

**Note:** Steps are now nested inside modules (new format) or at the root level (legacy format).

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `step` | Number | âœ… Yes | Step number within the module (1, 2, 3...) |
| `title` | String | âœ… Yes | Step title/name |
| `step_type` | String | âœ… Yes | Type of step: `"lesson"`, `"lab"`, `"quiz"`, `"project"`, `"exercise"`, `"video"` |
| `content_type` | String | âœ… Yes | Content format: `"text"`, `"code"`, `"video"`, `"interactive"` |
| `description` | String | âœ… Yes | Description of what the step covers |
| `estimatedTime` | Number | âœ… Yes | Estimated time in minutes (not hours) |
| `resources` | Array of Strings | âš ï¸ Optional | Learning resources for this step |
| `objectives` | Array of Strings | âœ… Yes | Learning objectives for this step |
| `skills_covered` | Array of Strings | âœ… Yes | List of skills covered by this step |

**Example Step:**
```json
{
  "step": 1,
  "title": "Variables and Data Types",
  "step_type": "lesson",
  "content_type": "text",
  "description": "Learn about C++ variable declarations and data types",
  "estimatedTime": 60,
  "resources": ["C++ Variables Guide", "Data Types Reference"],
  "objectives": ["Understand variable declarations", "Learn about data types"],
  "skills_covered": ["Variables and Data Types"]
}
```

### Step Object (Legacy Format - Root Level)

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `step` | Number | âš ï¸ Optional | Step number (0, 1, 2...) |
| `title` | String | âš ï¸ Optional | Step title/name |
| `duration` | String | âš ï¸ Optional | Estimated duration for this step |
| `resources` | Array of Strings | âš ï¸ Optional | Learning resources for this step |
| `objectives` | Array of Strings | âš ï¸ Optional | Learning objectives for this step |
| `estimatedTime` | String | âš ï¸ Optional | Estimated time to complete this step |

---

## ðŸ“ Complete Example (New Format with Structured Steps)

```json
{
  "user_id": "b2b400ed-bc11-4aa9-a89e-f4a00d0f6321",
  "user_name": "Noam",
  "company_id": "c1d2e3f4-5678-9012-3456-789012345678",
  "company_name": "TechCorp Inc.",
  "competency_target_name": "C++ basics Noam",
  "learning_path": {
    "pathTitle": "Personalized Mastery Path for C++ Developer to C++ basics Noam",
    "totalDurationHours": 82,
    "learning_modules": [
      {
        "module_order": 1,
        "module_title": "Module 1: C++ Foundational Syntax and Control Flow",
        "estimated_duration_hours": 4,
        "skills_in_module": [
          "Variables and Data Types",
          "Input and Output (cin, cout)",
          "Control Flow (if, switch, loops)"
        ],
        "learning_goals": [
          "Master basic C++ syntax, data types, console I/O, and fundamental control structures.",
          "Understand foundational C++ programming concepts."
        ],
        "steps": [
          {
            "step": 1,
            "title": "Variables and Data Types",
            "step_type": "lesson",
            "content_type": "text",
            "description": "Learn about C++ variable declarations and data types",
            "estimatedTime": 60,
            "resources": ["C++ Variables Guide", "Data Types Reference"],
            "objectives": ["Understand variable declarations", "Learn about data types"],
            "skills_covered": ["Variables and Data Types"]
          },
          {
            "step": 2,
            "title": "Input and Output (cin, cout)",
            "step_type": "lesson",
            "content_type": "interactive",
            "description": "Master console I/O operations",
            "estimatedTime": 45,
            "resources": ["I/O Tutorial"],
            "objectives": ["Use cin for input", "Use cout for output"],
            "skills_covered": ["Input and Output (cin, cout)"]
          },
          {
            "step": 3,
            "title": "Implementing Foundational C++ Programs",
            "step_type": "lab",
            "content_type": "code",
            "description": "Practice lab for foundational concepts",
            "estimatedTime": 90,
            "resources": ["Lab Instructions"],
            "objectives": ["Apply variables and I/O", "Write basic C++ programs"],
            "skills_covered": ["Variables and Data Types", "Input and Output (cin, cout)"]
          },
          {
            "step": 4,
            "title": "Module 1 Proficiency Quiz",
            "step_type": "quiz",
            "content_type": "interactive",
            "description": "Assessment for Module 1",
            "estimatedTime": 30,
            "resources": [],
            "objectives": ["Test understanding of foundational concepts"],
            "skills_covered": ["Variables and Data Types", "Input and Output (cin, cout)", "Control Flow (if, switch, loops)"]
          }
        ]
      },
      {
        "module_order": 2,
        "module_title": "Module 2: Functions, Modularity, and Scope Management",
        "estimated_duration_hours": 5,
        "skills_in_module": [
          "Functions and Parameters",
          "Scope and Lifetime of Variables",
          "Function Overloading"
        ],
        "learning_goals": [
          "Understand how to structure code with functions, manage variable scope, and overload functions for flexibility.",
          "Develop modular and reusable C++ code."
        ],
        "steps": [
          {
            "step": 1,
            "title": "Functions and Parameters",
            "step_type": "lesson",
            "content_type": "text",
            "description": "Learn function definition and parameter passing",
            "estimatedTime": 75,
            "resources": ["Functions Guide"],
            "objectives": ["Define functions", "Use parameters"],
            "skills_covered": ["Functions and Parameters"]
          }
          // ... more steps
        ]
      }
      // ... more modules (up to 14 modules in this example)
    ],
    "status": "approved",
    "metadata": {}
  }
}
```

---

## ðŸ”„ Handling Both Formats

**Course Builder and Content Studio should:**

1. **Check for `learning_modules` first** (primary format):
   ```javascript
   if (learning_path.learning_modules && Array.isArray(learning_path.learning_modules)) {
     // Process module-based format
     learning_path.learning_modules.forEach(module => {
       // Check for new format with steps
       if (module.steps && Array.isArray(module.steps)) {
         // New format: structured steps
         module.steps.forEach(step => {
           // Use step.title, step.step_type, step.content_type, step.skills_covered
         });
       } else if (module.suggested_content_sequence) {
         // Legacy format: string sequence
         module.suggested_content_sequence.forEach(content => {
           // Parse string format: "Lesson: Title (Nano: Skill)"
         });
       }
       
       // Use module.module_title, module.learning_goals
       // Skills: module.skills_in_module (new) or module.focus_micro_skills (legacy)
       const skills = module.skills_in_module || module.focus_micro_skills || [];
     });
   }
   ```

2. **Fallback to `steps` format** (legacy):
   ```javascript
   else if (learning_path.steps && Array.isArray(learning_path.steps)) {
     // Process step-based format
     learning_path.steps.forEach(step => {
       // Use step.title, step.objectives, step.resources
     });
   }
   ```

3. **Handle both formats** (if both are present):
   ```javascript
   // Prefer modules over steps
   const modules = learning_path.learning_modules || [];
   const steps = learning_path.steps || [];
   
   if (modules.length > 0) {
     // Use modules
   } else if (steps.length > 0) {
     // Use steps
   }
   ```

---

## âœ… Validation Checklist

When Course Builder/Content Studio receives a learning path, validate:

- [ ] `user_id` is present and valid UUID
- [ ] `user_name` is present and non-empty
- [ ] `company_id` is present and valid UUID
- [ ] `company_name` is present and non-empty
- [ ] `competency_target_name` is present and non-empty
- [ ] `learning_path` is present and is an object
- [ ] Either `learning_path.learning_modules` OR `learning_path.steps` is present (or both)
- [ ] If `learning_modules` exists, it's an array with at least one module
- [ ] If `steps` exists, it's an array (can be empty)
- [ ] Each module has: `module_order`, `module_title`, `estimated_duration_hours`, `focus_micro_skills`, `learning_goals`, `suggested_content_sequence`

---

## ðŸ“š Related Documentation

- **Prompt 3 Template:** `backend/src/infrastructure/prompts/prompts/prompt3-path-creation.txt`
- **Course Builder Payload:** `docs/guides/COURSE_BUILDER_JSON.md`
- **Learning Analytics Payload:** `docs/guides/LEARNING_ANALYTICS_JSON.md`

---

## ðŸŽ¯ Summary

**Primary Structure (New Format - Module-Based with Structured Steps):**
- Use `learning_modules` array
- Each module has: `module_order`, `module_title`, `estimated_duration_hours`, `skills_in_module`, `learning_goals`, `steps`
- Each step has: `step`, `title`, `step_type`, `content_type`, `description`, `estimatedTime`, `resources`, `objectives`, `skills_covered`
- Generated by Prompt 3 (Gemini AI) - **New format as of 2025**

**Legacy Structure (Module-Based with String Sequence):**
- Use `learning_modules` array
- Each module has: `module_order`, `module_title`, `estimated_duration_hours`, `focus_micro_skills`, `learning_goals`, `suggested_content_sequence`
- `suggested_content_sequence` is an array of strings (e.g., "Lesson: Title (Nano: Skill)")
- Generated by older versions of Prompt 3

**Root-Level Steps (Legacy):**
- Use `steps` array at root level
- Each step has: `step`, `title`, `duration`, `resources`, `objectives`, `estimatedTime`
- May be present for backward compatibility

**Recommendation:** Course Builder and Content Studio should:
1. **Prioritize** `learning_modules[].steps` (new structured format)
2. **Fallback** to `learning_modules[].suggested_content_sequence` (legacy string format)
3. **Support** root-level `steps` array (legacy format)

